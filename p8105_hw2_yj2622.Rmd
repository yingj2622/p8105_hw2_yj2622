---
title: "Homework 2"
author: "Ying Jin"
date: "2020/9/24"
output: github_document
---

This is the solution to homework 2!

```{r setup,include = FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

Read and clean the Mr. Trash Wheel data:

```{r read_clean_mtw,warning = FALSE}
mr_trash_wheel_data <- read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",sheet = "Mr. Trash Wheel",skip = 1,range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls)
  )
```

The first 10 rows of cleaned Mr. Trash Wheel data:

```{r show_mtw_data, echo = FALSE}
mr_trash_wheel_data
```

Read precipitation data:

```{r read_clean_precip}
precip_2018 <- read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",sheet = "2018 Precipitation",skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2018) %>% 
  relocate(year)

precip_2017 <- read_excel("./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",sheet = "2017 Precipitation",skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2017) %>% 
  relocate(year)
```

Combine annual precipitation:

```{r combine_precip}
month_df <- tibble(
  month = 1:12,
  month_name = month.name
)
precip_df <- bind_rows(precip_2017,precip_2018) %>% 
left_join( month_df, by = "month") %>% 
  select(-month) %>% 
  rename("month" ="month_name")
```

The first 10 rows of combined annual precipitation:

```{r show_precipdata, echo = FALSE}
precip_df
```

This dataset contains information from the Mr. Trash Wheel trash collector in Baltimore, Maryland. The trash enters the innder harbor, the trashwheel collectes that trash, and stores it in a dumpster. 

 * The dataset contains information on year, month and trash collected,  including some specific kind of trash. There are a total of `r   nrow(mr_trash_wheel_data)` rows in the final dataset. 
 
 * Additional data sheets include month precipitation data from 2014 to  2019. The combined precipitation dataset has `r nrow(precip_df)` rows   and key variables are year, month and precipitation amount. 
 
 * The total precipitation in 2018 was `r sum(pull(precip_df,total)[pull(precip_df,year) == 2018])`. The median    number of sports balls in 2017 was `r  median(pull(mr_trash_wheel_data,sports_balls)[pull(mr_trash_wheel_data,year) == 2017])`.

## Problem 2

Read and clean NYC transit data:

```{r read_clean_nyc_transit_data,message = FALSE}
nyc_transit_data <- read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(line, station_name, station_latitude, station_longitude, starts_with("route"), entry, vending, entrance_type, ada) %>% 
  mutate(entry = recode(entry, "YES" = TRUE,"NO" = FALSE))
```

The first 10 lines of the cleaned NYC transit dataset :

```{r}
nyc_transit_data
```

This dataset provides information about each entrance and exit for each subway in NYC.

 * It contains infromation on station name, location, routes and whether it's an entry.
 
 * There are total `r nrow(nyc_transit_data)` rows and `r ncol(nyc_transit_data)` columns in this dataset.
 
 * My cleaning steps:
 
   * change the variable names into proper format;
  
   * select columns needed;
  
   * convert the values of `entry` to logical variables.
  
 * And these data are not tidy because how routes were displayed are not proper.
 
 
 Then I try to answer questions in problem 2:
 
 First, I calculate the number of different subway stations:
 
```{r n_diff_station}
n_of_diff_station <- select(nyc_transit_data,station_name,line) %>% 
  distinct %>% 
  nrow
```
 
 
 There are `r n_of_diff_station` different stations in the dataset.
 
 Next, I try to find the number of stations with ADA compliance:
 
```{r n_ada_station}
n_of_station_with_ada <- select(nyc_transit_data,station_name,line,ada) %>% distinct(station_name,line,.keep_all = TRUE) %>% 
  filter(ada == TRUE) %>%
  nrow
```
 
 
 There are `r n_of_station_with_ada` stations which are ADA compliant.
 
 Then, I calculate the proportion of entrances/ exits without vending allow entrance:
 
```{r pro_entr_no_vending}
n_of_station_no_vending <- select(nyc_transit_data,station_name,line,vending) %>% distinct(station_name,line,.keep_all = TRUE) %>% filter(vending == "NO") %>% nrow

p <- n_of_station_no_vending/ n_of_diff_station
```
 
 
There are `r  round(p,digits = 3) * 100`% of entrances/exits without vending allow entrance.
 
To answer the left questions, I reformat data to make route number and route name become distinct variables. Since the value typs of columns start with "route" is different, I also convert those which are double into character:

```{r}
nyc_transit_tidy_data <- mutate(
  nyc_transit_data,
 across(route8:route11,as.character)) %>% 
  pivot_longer(
  cols = starts_with("route"),
  names_to = "route_number",
  names_prefix = "routine",
  values_to = "route_name"
)
```

Here are the first 10 rows of the reformatted dataset:

```{r}
nyc_transit_tidy_data
```

Then get the table of distinct stations serving the A train:

```{r}
station_serve_a_df <- select(nyc_transit_tidy_data,station_name,line,route_name,ada) %>% 
  distinct(station_name,line,.keep_all = TRUE) %>% 
  filter(route_name == "A")
```

So we can get that there are `r nrow(station_serve_a_df)` stations serving A train

In the end, I get the number of stations serving A train which are ADA compliant:

```{r}
n_of_station_a_ada <- filter(station_serve_a_df,ada == TRUE) %>% nrow
```

So there are `r n_of_station_a_ada` stations which both serve A train and are ADA compliant.

## Problem 3

First, I read and clean the data in `pols-month.csv`:

```{r read_clean_pols_month_data, message = FALSE}
pols_month_data <- read_csv("./data/fivethirtyeight_datasets/pols-month.csv") %>%
  separate(mon,c("year","month","day"),sep = "-") %>% 
  mutate(month = month.abb[as.numeric(month)]) %>% 
  mutate(president = ifelse(prez_gop != 0,"gop","dem")) %>% 
  select(-prez_gop,-prez_dem) %>% 
  select(-day)
  
```

The cleaned dataset is as follow (10 lines):

```{r}
pols_month_data
```

